<?php 
$not_found = '<div class="empty_state"><svg enable-background="new 0 0 32 32" height="512" viewBox="0 0 32 32" width="512" xmlns="http://www.w3.org/2000/svg"><path d="m26 32h-20c-3.314 0-6-2.686-6-6v-20c0-3.314 2.686-6 6-6h20c3.314 0 6 2.686 6 6v20c0 3.314-2.686 6-6 6z" fill="#f5e6fe"/><path d="m17.5 8h-7.667c-1.013 0-1.833.82-1.833 1.833v10.333c0 1.014.82 1.834 1.833 1.834h5.427c-.587-.8-.927-1.773-.927-2.833 0-2.667 2.167-4.833 4.833-4.833.053 0 .113 0 .167.007v-4.508c0-1.013-.82-1.833-1.833-1.833zm-6.833 2.667h2.667c.367 0 .667.3.667.667s-.301.666-.668.666h-2.667c-.366 0-.666-.3-.666-.667s.3-.666.667-.666zm3.333 6.666h-3.333c-.367 0-.667-.3-.667-.667s.3-.666.667-.666h3.333c.367 0 .667.3.667.667s-.3.666-.667.666zm2.667-2.666h-6c-.367 0-.667-.3-.667-.667s.3-.667.667-.667h6c.367 0 .667.3.667.667-.001.367-.301.667-.667.667z" fill="#be63f9"/><g fill="#d9a4fc"><path d="m19.167 22.667c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5zm0-5.667c-1.195 0-2.167.972-2.167 2.167s.972 2.167 2.167 2.167 2.167-.972 2.167-2.167c-.001-1.195-.973-2.167-2.167-2.167z"/><path d="m23.333 24c-.171 0-.341-.065-.471-.195l-2.167-2.167c-.26-.26-.26-.682 0-.943s.682-.26.943 0l2.167 2.167c.26.26.26.682 0 .943-.13.13-.301.195-.472.195z"/></g></svg> ' . $wo["lang"]["no_result"] . '</div>';
$type_to_find = '<div class="empty_state"><svg enable-background="new 0 0 32 32" height="512" viewBox="0 0 32 32" width="512" xmlns="http://www.w3.org/2000/svg"><path d="m26 32h-20c-3.314 0-6-2.686-6-6v-20c0-3.314 2.686-6 6-6h20c3.314 0 6 2.686 6 6v20c0 3.314-2.686 6-6 6z" fill="#ffe6e2"/><g fill="#fc573b"><path d="m23.333 24c-.171 0-.341-.065-.471-.195l-4.924-4.924c-.26-.26-.26-.682 0-.943s.682-.26.943 0l4.924 4.924c.26.26.26.682 0 .943-.13.13-.301.195-.472.195z"/><path d="m14.333 8c-3.492 0-6.333 2.841-6.333 6.333s2.841 6.333 6.333 6.333 6.333-2.841 6.333-6.333-2.84-6.333-6.333-6.333zm1.361 9.26c0 .407-.333.74-.747.74h-1.227c-.36 0-.747-.267-.747-.86v-.36h2.72v.48zm.54-1.973c-.28.227-.46.52-.52.827h-2.754c-.047-.3-.213-.58-.487-.793-.74-.58-1.16-1.453-1.14-2.4.033-1.587 1.36-2.9 2.953-2.92.807-.02 1.58.293 2.16.867.573.56.887 1.313.887 2.113.001.899-.399 1.739-1.099 2.306z"/></g></svg> ' . $wo["lang"]["what_are_looking_for"] . '</div>';
?>
<style>
@-moz-document url-prefix(){    
	.tag_srch_fltr_country select, .tag_srch_fltr_country input, .tag_srch_fltr_country textarea {
		text-indent: 10px;
	}
}
@media only screen and (max-width: 600px) {
	.tag_srch_fltr_country select, .tag_srch_fltr_country input, .tag_srch_fltr_country textarea {
		text-indent: 25px;
	}
}
</style>

<div class="page-margin">
	<div class="container">
		<form action="<?php echo Wo_SeoLink('index.php?link1=search') ?>" method="get" class="search-filter-form" id="search_form">
			<div class="wow_content p20">
				<div class="valign tag_srch_input">
					<input type="text" class="text-center width-dynamic" name="query" id="query" placeholder="<?php echo $wo['lang']['keyword'];?>" value="<?php echo (isset($_GET['query'])) ? Wo_Secure($_GET['query']): '';?>" autocomplete="off">
					<button type="button" class="search_btn btn btn-main btn-mat" title="<?php echo $wo['lang']['search'];?>"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"></path></svg></button>
				</div>
				<div class="valign tag_srch_filters">
					<?php echo Wo_LoadPage('search/filters/user_filters');?>
				</div>
			</div>
		</form>
	
		<div class="page-margin wow_content">
			<div class="valign mb-15">
				<ul class="valign nav nav-tabs tag_switch_noti switch_search_category" role="tablist">
					<li role="presentation"><a onclick="searchType('users')" href="" class="active" aria-controls="users" role="tab" data-toggle="tab"><?php echo $wo['lang']['users'];?></a></li>
					<?php if ($wo['config']['pages'] == 1) { ?>
						<li role="presentation"><a onclick="searchType('pages')" href="" aria-controls="pages" role="tab" data-toggle="tab"><?php echo $wo['lang']['pages'];?></a></li>
					<?php } ?>
					<?php if ($wo['config']['groups'] == 1) { ?>
						<li role="presentation"><a onclick="searchType('groups')" href="" aria-controls="groups" role="tab" data-toggle="tab"><?php echo $wo['lang']['groups'];?></a></li>
					<?php } ?>
					<?php if ($wo['config']['games'] == 1) { ?>
						<li role="presentation"><a onclick="searchType('games')" href="" aria-controls="games" role="tab" data-toggle="tab"><?php echo $wo['lang']['games'];?></a></li>
					<?php } ?>
				</ul>
			</div>
			<div class="tab-content">
				<div id="users" class="tab-pane active">
					<div id="users-cont" class="row tag_srch_rslt_usr_row">
						<?php
							$search_query = '';
							if (!isset($_GET['query'])) {
								echo $type_to_find;
							}
							if (isset($_GET['query'])) {
								$search_query = Wo_GetSearchFilter($_GET, 30);
								if (count($search_query) != 0) {
									foreach ($search_query as $wo['result']) {
										if (!empty($wo['result']['avatar_full'])) {
											$wo['result']['avatar'] = Wo_GetMedia($wo['result']['avatar_full']);
										}
										echo Wo_LoadPage('search/user-result');
									}
								} else {
									echo $not_found;
								}
							}
						?>
					</div>
					<div class="clear"></div>
					<?php if (!empty($search_query)) { ?>
						<div class="load-more">
							<button class="btn btn-default text-center pointer load-more-users mb-15"><span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"></path></svg></span> <?php echo $wo['lang']['load_more_users'] ?></button>
						</div>
					<?php } ?>
				</div>
				<?php if ($wo['config']['pages'] == 1) { ?>
					<div id="pages" class="tab-pane">
						<div id="pages-cont">
							<?php
								$search_query = '';
								if (!isset($_GET['query'])) {
									echo $type_to_find;
								}
								if (isset($_GET['query'])) {
									$search_query = Wo_GetSearchAdv($_GET['query'], 'pages');
									if (count($search_query) != 0) {
										foreach ($search_query as $wo['result']) {
											echo Wo_LoadPage('search/page-result');
										}
									} else {
										echo $not_found;
									}
								}
							?>
						</div>
						<div class="clear"></div>
						<?php if (!empty($search_query)) { ?>
							<div class="load-more">
								<button class="btn btn-default text-center pointer load-more-pages mb-15"><span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"></path></svg></span> <?php echo $wo['lang']['load_more_pages'] ?></button>
							</div>
						<?php } ?>
					</div>
				<?php } ?>
				<?php if ($wo['config']['groups'] == 1) { ?>
					<div id="groups" class="tab-pane">
						<div id="groups-cont" class="row">
							<?php
								$search_query = '';
								if (!isset($_GET['query'])) {
									echo $type_to_find;
								}
								if (isset($_GET['query'])) {
									$search_query = Wo_GetSearchAdv($_GET['query'], 'groups');
									if (count($search_query) != 0) {
										foreach ($search_query as $wo['result']) {
											echo Wo_LoadPage('search/group-result');
										}
									} else {
										echo $not_found;
									}
								}
							?>
						</div>
						<div class="clear"></div>
						<?php if (!empty($search_query)) { ?>
							<div class="load-more">
								<button class="btn btn-default text-center pointer load-more-groups mb-15"><span><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M7.41,8.58L12,13.17L16.59,8.58L18,10L12,16L6,10L7.41,8.58Z"></path></svg></span> <?php echo $wo['lang']['load_more_groups'] ?></button>
							</div>
						<?php } ?>
					</div>
				<?php } ?>
				<?php if ($wo['config']['games'] == 1) { ?>
					<div id="games" class="tab-pane">
						<div class="row wow_srch_game_tabss">
							<?php
								if (!isset($_GET['query'])) {
									echo $type_to_find;
								}
								if (isset($_GET['query'])) {
									$search_query = Wo_GetSearchAdv($_GET['query'], 'games');
									if (count($search_query) != 0) {
										foreach ($search_query as $wo['game']) {
											echo Wo_LoadPage('games/game-style');
										}
									} else {
										echo $not_found;
									}
								}
							?>
						</div>
					</div>
				<?php } ?>
			</div>
			<div class="clear"></div>
		</div>
	</div>
</div>

<script>
$.fn.textWidth = function(text, font) {
    if (!$.fn.textWidth.fakeEl) $.fn.textWidth.fakeEl = $('<span>').hide().appendTo(document.body);
    $.fn.textWidth.fakeEl.text(text || this.val() || this.text() || this.attr('placeholder')).css('font', font || this.css('font'));
    return $.fn.textWidth.fakeEl.width();
};

$('.width-dynamic').on('input', function() {
    var inputWidth = $(this).textWidth();
    $(this).css({
        width: inputWidth
    })
}).trigger('input');

function inputWidth(elem, minW, maxW) {
    elem = $(this);
    console.log(elem)
}

let search_type = 'users'

function changeTypeFilters() {
	const filtersContainer = $('.tag_srch_filters')

	let url = `type=${search_type}`

	$.ajax({
		url: Wo_Ajax_Requests_File()+'?f=search_change_filters&' + url,
		type: 'get',
		success:function(data){
			filtersContainer.html(data['html'])
			search();
		}
	})  
}

function searchType(type) {
	search_type = type;
	changeTypeFilters();
}

function search() {
	let url = ''

	const fid_3 = $('#dropdown-fid_3 .themes_dropdown_item.active').data('id') ?  $('#dropdown-fid_3 .themes_dropdown_item.active').data('id') : ''
	const fid_4 = $('#dropdown-fid_4 .themes_dropdown_item.active').data('id') ?  $('#dropdown-fid_4 .themes_dropdown_item.active').data('id') : ''

	if('users' === search_type) {
		url = `type=${search_type}&query=${$('#query').val()}&country=${$('#country').val()}&age_from=${$('#age_from').val()}&age_to=${$('#age_to').val()}&filterbyage=${$('input[name=filterbyage]:checked').val()}&verified=${$('input[name=verified]:checked').val()}&status=${$('input[name=status]:checked').val()}&gender=${$('input[name=gender]:checked').val()}&image=${$('input[name=image]:checked').val()}&fid_3=${fid_3}&fid_4=${fid_4}`
	} else {
		url = `type=${search_type}&query=${$('#query').val()}&fid_3=${fid_3}&privacy=${$('input[name=privacy]:checked').val()}`
	}
	
	$.ajax({
		url: Wo_Ajax_Requests_File()+'?f=search&s=search_page&' + url,
		type: 'get',
		success:function(data){
			$("#users-cont").html(data['html'])
		}
	})  
}

var targetElem = $('.width-dynamic');

inputWidth(targetElem);

  jQuery(document).ready(function($) {
	/*Search function*/
	$(".search_btn").on("click", () => search())
	
    /*Load more users*/
    $(".load-more-users").click(function(event) {
      var form = document.getElementById('search_form');
	  var formdata = new FormData(form);

	  const fid_3 = $('#dropdown-fid_3 .themes_dropdown_item.active').data('id') ?  $('#dropdown-fid_3 .themes_dropdown_item.active').data('id') : ''

	  formdata.append('fid_3', fid_3)

      var u_offset = ($("[data-search-type=user]").length > 0) ? $("[data-search-type=user]").last().attr('data-id') : 0;
      $.ajax({
      	processData: false,
        url: Wo_Ajax_Requests_File()+`?f=load-more-users&offset=`+u_offset,
        type: 'POST',
		data: formdata,
        dataType: 'json',
        contentType: false,
        success:function(data){
          if (data['status'] == 200) {
            $("#users-cont").append(data['html'])
          }else{$(".load-more-users").remove()}
        }
      })    
    });
    //Load more groups
    $(".load-more-groups").click(function(event) {
      var g_offset = ($("[data-search-type=group]").length > 0) ? $("[data-search-type=group]").last().attr('data-id') : 0;
      $.ajax({
        url: Wo_Ajax_Requests_File(),
        type: 'GET',
        dataType: 'json',
        data: {f: 'load-more-groups',offset:g_offset,query:$("#query").val()},
        success:function(data){
          if (data['status'] == 200) {
            $("#groups-cont").append(data['html'])
          }else{$(".load-more-groups").remove()}
        }
      })   
    });
    //Load more pages
    $(".load-more-pages").click(function(event) {
      var p_offset = ($("[data-search-type=page]").length > 0) ? $("[data-search-type=page]").last().attr('data-id') : 0;
      $.ajax({
        url: Wo_Ajax_Requests_File(),
        type: 'GET',
        dataType: 'json',
        data: {f: 'load-more-pages',offset:p_offset,query:$("#query").val()},
        success:function(data){
          if (data['status'] == 200) {
            $("#pages-cont").append(data['html'])
          }else{$(".load-more-pages").remove()}
        }
      })   
    });
  });
</script>